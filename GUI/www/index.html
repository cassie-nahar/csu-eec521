<!DOCTYPE html>
<html>
    <head>
	    <meta charset="UTF-8">
		<title>APC GUI Demo</title>
		<script src="https://www.gstatic.com/charts/loader.js"></script>
		<script src="https://code.jquery.com/jquery-3.4.1.min.js"
		        integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo="
				crossorigin="anonymous"></script>
	</head>
	<body>
	    <div id="wrap">
		    <div id="temperature_chart_div" style="height:500px;"></div>
		</div>
		<div id="wrap">
		    <div id="humidity_chart_div" style="height:500px;"></div>
		</div>

        <script type="text/javascript">
		    google.charts.load('current', {packages: ['corechart', 'line']});
			google.charts.setOnLoadCallback(drawBasic);
			var newData;
			function drawBasic() {
			    $.get("db", "", function(newData) {
				    var tempData = new google.visualization.DataTable();
					tempData.addColumn('string', 'X');
					tempData.addColumn('number', 'Temperature (°C)');
					var humidityData = new google.visualization.DataTable();
					humidityData.addColumn('string', 'X');
					humidityData.addColumn('number', 'Humidity');
					var result = JSON.parse(newData).result;
					result.forEach(element => {
					    tempData.addRow([element.datetime,parseFloat(element.temperature)]);
						humidityData.addRow([element.datetime,parseFloat(element.humidity)]);
					});

                    var tempOptions = {
					    chartArea: {
						    top: 20,
							height: '75%'
						},
						legend: {position: 'top'},
						hAxis: {
						    title: 'Time'
						},
						vAxis: {
						    title: 'Temperature (°C)'
						}
					};

                    var humidityOptions = {
					    chartArea: {
						    top: 20,
							height: '75%'
						},
						legend: {position: 'top'},
						hAxis: {
						    title: 'Time'
						},
						vAxis: {
						    title: 'Humidity'
						}
					};

                    var tempChart = new google.visualization.LineChart(document.getElementById('temperature_chart_div'));
					tempChart.draw(tempData, tempOptions);

                    var humidityChart = new google.visualization.LineChart(document.getElementById('humidity_chart_div'));
					humidityChart.draw(tempData, humidityOptions);
				});
			};

            window.setInterval(drawBasic, 5000);
		</script>
	</body>
</html>
