<!DOCTYPE html>
<html>
    <head>
	    <meta charset="UTF-8">
		<title>APC GUI Demo</title>
		<script src="https://www.gstatic.com/charts/loader.js"></script>
		<script src="https://code.jquery.com/jquery-3.4.1.min.js"
		        integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo="
				crossorigin="anonymous"></script>
	</head>
	<body>
	    <div id="wrap">
		    <div id="chart_div" style="height:500px;"></div>
		</div>

        <script type="text/javascript">
		    google.charts.load('current', {packages: ['corechart', 'line']});
			google.charts.setOnLoadCallback(drawBasic);
			var newData;
			function drawBasic() {
			    $.get("db", "", function(newData) {
				    var data = new google.visualization.DataTable();
					data.addColumn('string', 'X');
					data.addColumn('number', 'Temperature (°C)');
					var result = JSON.parse(newData).result;
					result.forEach(element => data.addRow([element.datetime,parseFloat(element.temperature)]));

                    var options = {
					    chartArea: {
						    top: 20,
							height: '75%'
						},
						legend: {position: 'top'},
						hAxis: {
						    title: 'Time'
						},
						vAxis: {
						    title: 'Temperature (°C)'
						}
					};

                    var chart = new google.visualization.LineChart(document.getElementById('chart_div'));
					chart.draw(data, options);
				});
			};

            window.setInterval(drawBasic, 5000);
		</script>
	</body>
</html>
